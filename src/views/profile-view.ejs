<%- include('partials/header', { title: (target.alias || target.display_name) }) %>

<section class="profile-view-layout">
  <div class="profile-main">
    <section class="card">
      <div class="profile-hero">
        <img
          src="<%= targetAvatarUrl %>"
          alt="<%= target.alias || target.display_name %>"
          class="avatar-lg"
          loading="lazy"
          onerror="this.onerror=null;this.src='/default-avatar.svg';"
        />
        <div>
          <h1><%= target.alias || target.display_name %></h1>
          <% if (target.alias) { %>
            <p class="alias-chip"><%= target.alias %> aka <%= target.display_name %></p>
          <% } %>
          <p class="muted"><%= target.email %></p>
          <% if (target.bio) { %>
            <p class="bio-card">"<%= target.bio %>"</p>
          <% } %>
          <p class="muted">Joined: <%= new Date(target.created_at).toLocaleDateString() %></p>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>What People Wrote</h2>
      <% if (!entries.length) { %>
        <p class="muted">No posts yet.</p>
      <% } %>

      <div class="entry-list">
        <% entries.forEach((entry) => { %>
          <article class="entry">
            <div class="entry-meta">
              <strong><a class="name-link" href="/profile/<%= entry.author_share_code %>"><%= entry.author_name %></a></strong>
              <span><%= new Date(entry.created_at).toLocaleString() %></span>
              <span class="pill"><%= entry.type %></span>
              <% if (isAdmin) { %>
                <form action="/admin/posts/<%= entry.id %>/delete" method="POST" class="inline-form">
                  <input type="hidden" name="return_to" value="/profile/<%= target.share_code %>" />
                  <button type="submit" class="danger-btn">Remove Post</button>
                </form>
              <% } %>
            </div>

            <% if (entry.type === 'text') { %>
              <p class="entry-text"><%= entry.text_content %></p>
            <% } %>

            <% if (entry.type === 'image') { %>
              <img src="/<%= entry.file_path %>" alt="Shared image" class="entry-image" />
            <% } %>

            <% if (entry.type === 'audio') { %>
              <audio controls class="entry-audio">
                <source src="/<%= entry.file_path %>" type="<%= entry.mime_type %>" />
                Your browser does not support audio playback.
              </audio>
            <% } %>
          </article>
        <% }) %>
      </div>
    </section>
  </div>

  <aside class="profile-side">
    <section class="card side-card">
      <h3>D25 Snapshot</h3>
      <div class="stats-grid">
        <article class="metric"><span>TT High Score</span><strong><%= ttHighScore %></strong></article>
        <article class="metric"><span>Total Posts</span><strong><%= entries.length %></strong></article>
        <article class="metric"><span>Text</span><strong><%= entries.filter((e) => e.type === 'text').length %></strong></article>
        <article class="metric"><span>Images</span><strong><%= entries.filter((e) => e.type === 'image').length %></strong></article>
        <article class="metric"><span>Audio</span><strong><%= entries.filter((e) => e.type === 'audio').length %></strong></article>
      </div>
    </section>

    <section class="card side-card">
      <h3>Quick Actions</h3>
      <div class="stack-form">
        <% if (currentUser) { %>
          <a href="/write/<%= target.share_code %>" class="primary-btn">Write on Page</a>
        <% } %>
        <a href="/people" class="secondary-btn">Back to People</a>
      </div>
    </section>
  </aside>
</section>

<%- include('partials/footer') %>
